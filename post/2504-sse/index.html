<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Blog"><meta name="msapplication-TileColor" content="#000000"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"><meta name="baidu-site-verification" content="codeva-tU6pIQVfyl"><meta name="msvalidate.01" content="96ADAC3B4A010DE98F0350319BAF9DAB"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"><link rel="icon" href="/favicon.ico"><title>
      SSE 服务端推送
    </title><!-- 基础 SEO --><meta name="description" content="Server-Sent Events (SSE) 是一种服务器推送技术，允许服务器向客户端实时推送数据。在以下场景特别有用："><meta name="author" content="Aleks"><meta name="keywords" content="Network"><link rel="canonical" href="https://blog.002085.xyz//post/2504-sse"><!-- Open Graph --><meta property="og:type" content="article"><meta property="og:title" content="SSE 服务端推送"><meta property="og:description" content="Server-Sent Events (SSE) 是一种服务器推送技术，允许服务器向客户端实时推送数据。在以下场景特别有用："><meta property="og:image" content="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/networkx/networkx-original.svg"><meta property="og:url" content="https://blog.002085.xyz//post/2504-sse"><meta property="og:site_name" content="Aleks"><meta property="article:published_time" content="2025-04-03T07:35:49.000Z"><meta property="article:modified_time" content="2025-12-01T09:28:48.190Z"><meta property="article:tag" content="Network"><meta property="article:author" content="Aleks"><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="SSE 服务端推送"><meta name="twitter:description" content="Server-Sent Events (SSE) 是一种服务器推送技术，允许服务器向客户端实时推送数据。在以下场景特别有用："><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/networkx/networkx-original.svg"><!-- JSON-LD 结构化数据 --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"SSE 服务端推送","description":"Server-Sent Events (SSE) 是一种服务器推送技术，允许服务器向客户端实时推送数据。在以下场景特别有用：","image":"https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/networkx/networkx-original.svg","datePublished":"2025-04-03T07:35:49.000Z","dateModified":"2025-12-01T09:28:48.190Z","author":{"@type":"Person","name":"Aleks"},"publisher":{"@type":"Organization","name":"Aleks","logo":{"@type":"ImageObject","url":"https://blog.002085.xyz/favicon.ico"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.002085.xyz//post/2504-sse"},"keywords":"Network"}</script><!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-G1EC4WNBZJ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-G1EC4WNBZJ");
    </script> --><!-- Privacy-friendly analytics by Plausible --><script async src="https://plausible.io/js/pa-bqrNOvlYoay2S1opDAt9D.js"></script><script type="module">let i=document.title,t;document.addEventListener("visibilitychange",()=>{const e=document.querySelector("link[rel*='icon']");document.hidden?(document.title!=="快回来吧 T_T"&&document.title!=="你来啦!OvO"&&(i=document.title),document.title="快回来吧 T_T",e&&(e.href="/failure.ico"),t&&clearTimeout(t)):(document.title="你来啦!OvO",e&&(e.href="/favicon.ico"),t=window.setTimeout(()=>{document.title=i},1e3))});</script><script>
      // 暗色模式初始化
      const theme = (() => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      })();

      if (theme === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }

      window.localStorage.setItem("theme", theme);
    </script><link rel="stylesheet" href="/assets/about.C2LiP66Q.css">
<link rel="stylesheet" href="/assets/index.DI2Kqa3G.css">
<style>@media(min-width:1024px){.layout-grid-cols[data-astro-cid-ztig7rse]{grid-template-columns:minmax(0,1fr) 240px}}
</style></head> <body class="bg-bg text-text min-h-screen flex flex-col font-sans transition-colors duration-300">  <header id="main-header" class="sticky top-0 z-50 w-full bg-bg border-b-2 border-text transition-transform duration-300"> <div class="max-w-[800px] mx-auto px-4 h-16 flex items-center justify-between"> <a href="/" class="text-xl font-bold flex items-center gap-2 hover:text-primary transition-colors" aria-label="homepage"> <div class="i-ri:home-4-line w-6 h-6"></div> </a> <div class="flex items-center gap-4"> <nav class="hidden md:flex items-center gap-6"> <a href="/archives" class="text-sm font-medium hover:text-primary transition-colors">
归档
</a> <a href="/tags" class="text-sm font-medium hover:text-primary transition-colors">
标签
</a> <a href="/about" class="text-sm font-medium hover:text-primary transition-colors">
关于
</a> </nav>  <div class="flex items-center gap-3 pl-4 border-l border-text"> <a href="https://github.com/AleksChen" target="_blank" class="hover:text-primary transition-transform hover:scale-110" title="GitHub"> <div class="i-ri:github-fill w-6 h-6"></div> </a> <button id="theme-toggle" class="hover:text-primary transition-transform hover:scale-110 focus:outline-none" title="Toggle Theme"> <div class="i-ri:sun-line w-6 h-6 dark:hidden"></div> <div class="i-ri:moon-line w-6 h-6 hidden dark:block"></div> </button> </div> </div> </div> </header> <main class="flex-1 w-full mx-auto px-4 py-8 animate-fade-in max-w-[1200px]">  <div class="grid grid-cols-1 gap-8 items-start layout-grid-cols" data-astro-cid-ztig7rse> <article class="w-full min-w-0 bg-card p-4 md:p-8 rounded-lg border-2 border-text shadow-[4px_4px_0_0_var(--color-text)]" data-astro-cid-ztig7rse>  <header class="mb-8 pb-8 border-b border-border" data-astro-cid-ztig7rse> <div class="flex flex-wrap gap-2 mb-4" data-astro-cid-ztig7rse> <a href="/tag/Network" class="px-2 py-1 text-xs font-bold rounded-sm border border-text text-text bg-transparent shadow-[2px_2px_0_0_var(--color-text)] hover:translate-y-[1px] hover:translate-x-[1px] hover:shadow-none transition-all" data-astro-cid-ztig7rse>
#Network </a> </div> <h1 class="text-3xl md:text-4xl font-bold mb-4 leading-tight text-text" data-astro-cid-ztig7rse> SSE 服务端推送 </h1> <div class="flex items-center gap-4 text-sm text-text-muted" data-astro-cid-ztig7rse> <time datetime="2025-04-03T07:35:49.000Z" class="flex items-center gap-1" data-astro-cid-ztig7rse> <div class="i-ri:calendar-line" data-astro-cid-ztig7rse></div> 4/3/2025 </time> <span class="flex items-center gap-1" title="最后更新时间" data-astro-cid-ztig7rse> <div class="i-ri:time-line" data-astro-cid-ztig7rse></div> 12/1/2025 </span> </div> </header>  <div class="prose prose-lg dark:prose-invert max-w-none break-words prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-headings:scroll-mt-24" data-astro-cid-ztig7rse> <h2 id="引言">引言</h2>
<p>Server-Sent Events (SSE) 是一种服务器推送技术，允许服务器向客户端实时推送数据。在以下场景特别有用：</p>
<ul>
<li>实时数据更新（如股票价格、天气信息）</li>
<li>社交媒体信息流</li>
<li>实时日志显示</li>
<li>进度通知</li>
</ul>
<p><figure class="my-6 flex flex-col items-center"> <img src="/post-assets/m911icos-Pasted-image-20250402200626.webp" alt="Pasted image 20250402200626.webp" class="rounded-lg shadow-sm border border-border max-w-full h-auto" loading="lazy"> <figcaption class="text-center text-sm text-text-muted mt-2 italic"> Pasted image 20250402200626.webp </figcaption> </figure></p>
<h2 id="sse-的本质">SSE 的本质</h2>
<p>SSE 本质上是基于 HTTP 协议的单向通信机制：</p>
<ul>
<li>使用 HTTP 长连接实现服务器到客户端的单向数据流</li>
<li>数据格式为纯文本，编码必须是 UTF-8</li>
<li>基于标准 HTTP 协议，无需特殊协议支持</li>
</ul>
<h2 id="sse-的特点">SSE 的特点</h2>
<ol>
<li>单向通信：服务器到客户端的单向数据流</li>
<li>自动重连：断开后默认自动重连</li>
<li>简单易用：使用标准 HTTP，无需 WebSocket 的复杂配置</li>
<li>支持自定义事件</li>
<li>天然支持跨域（CORS）</li>
</ol>
<h2 id="sse-客户端-api">SSE 客户端 API</h2>
<p>基本使用示例：</p>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> evtSource</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#D73A49;--shiki-dark:#C678DD"> new</span><span style="color:#6F42C1;--shiki-dark:#61AFEF"> EventSource</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;/events&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// 监听消息</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">evtSource</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">onmessage</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#D73A49;--shiki-dark:#C678DD"> function</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic">event</span><span style="color:#24292E;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">    const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> data</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> JSON</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">parse</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#24292E;--shiki-dark:#E5C07B">event</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#24292E;--shiki-dark:#E06C75">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    console</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">log</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#24292E;--shiki-dark:#E06C75">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// 监听连接打开</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">evtSource</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">onopen</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#D73A49;--shiki-dark:#C678DD"> function</span><span style="color:#24292E;--shiki-dark:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    console</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">log</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;连接已建立&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// 监听错误</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">evtSource</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">onerror</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#D73A49;--shiki-dark:#C678DD"> function</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic">err</span><span style="color:#24292E;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    console</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">error</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;发生错误:&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, </span><span style="color:#24292E;--shiki-dark:#E06C75">err</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// 监听自定义事件</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">evtSource</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">addEventListener</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;custom-event&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, </span><span style="color:#D73A49;--shiki-dark:#C678DD">function</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic">e</span><span style="color:#24292E;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    console</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">log</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;自定义事件:&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, </span><span style="color:#24292E;--shiki-dark:#E5C07B">e</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#24292E;--shiki-dark:#E06C75">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// 关闭连接</span></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">// evtSource.close();</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> <script type="module">function c(){document.querySelectorAll(".copy-block-init").forEach(e=>e.remove()),document.querySelectorAll(".code-block").forEach(e=>{if(e.hasAttribute("data-copy-init"))return;e.setAttribute("data-copy-init","true");const i=e.querySelector(".copy-btn");i&&i.addEventListener("click",async()=>{const o=e.querySelector("code");if(!o)return;const n=o.innerText;try{await navigator.clipboard.writeText(n);const t=i.querySelector("div"),r=i.querySelector("span");t&&(t.className="i-ri:check-line text-blue-500 text-sm"),r&&(r.innerText="Copied!",r.className="text-blue-500"),setTimeout(()=>{t&&(t.className="i-ri:file-copy-line text-sm"),r&&(r.innerText="Copy",r.className="")},2e3)}catch(t){console.error("Failed to copy:",t)}})})}document.addEventListener("astro:page-load",c);c();</script>
<h2 id="sse-服务端实现">SSE 服务端实现</h2>
<h3 id="数据格式">数据格式</h3>
<p>服务器发送的数据必须遵循特定格式：</p>
<ul>
<li>每条消息以 <code>data:</code> 开头</li>
<li>每条消息以 <code>\n\n</code> 结尾</li>
<li>支持多个字段：data、event、id、retry</li>
</ul>
<h3 id="data-字段">data 字段</h3>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>data: 消息内容\n\n</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<p>多行数据：</p>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>data: 第一行\n</span></span>
<span class="line"><span>data: 第二行\n\n</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<h3 id="id-字段">id 字段</h3>
<p>用于消息标识，断线重连时会发送 <code>Last-Event-ID</code> 头：</p>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>id: 1\n</span></span>
<span class="line"><span>data: 消息内容\n\n</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<h3 id="event-字段">event 字段</h3>
<p>用于指定事件类型：</p>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>event: custom-event\n</span></span>
<span class="line"><span>data: 消息内容\n\n</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<h3 id="retry-字段">retry 字段</h3>
<p>指定重连时间（毫秒）：</p>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="text"><code><span class="line"><span>retry: 10000\n</span></span>
<span class="line"><span>data: 消息内容\n\n</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<h2 id="node-服务器实例">Node 服务器实例</h2>
<div class="code-block relative group my-6 overflow-hidden">  <div class="relative"> <pre class="astro-code astro-code-themes github-light one-dark-pro !my-0 !p-4 overflow-x-auto custom-scrollbar text-sm leading-relaxed !bg-transparent" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;overflow-x:auto" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> express</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#6F42C1;--shiki-dark:#61AFEF"> require</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;express&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> app</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#6F42C1;--shiki-dark:#61AFEF"> express</span><span style="color:#24292E;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">app</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">get</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;/events&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, (</span><span style="color:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic">req</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, </span><span style="color:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic">res</span><span style="color:#24292E;--shiki-dark:#ABB2BF">) </span><span style="color:#D73A49;--shiki-dark:#C678DD">=&gt;</span><span style="color:#24292E;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    // 设置 SSE 所需的 headers</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    res</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">writeHead</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#005CC5;--shiki-dark:#D19A66">200</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379">        &#39;Content-Type&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">: </span><span style="color:#032F62;--shiki-dark:#98C379">&#39;text/event-stream&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379">        &#39;Cache-Control&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">: </span><span style="color:#032F62;--shiki-dark:#98C379">&#39;no-cache&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#98C379">        &#39;Connection&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">: </span><span style="color:#032F62;--shiki-dark:#98C379">&#39;keep-alive&#39;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    // 发送初始数据</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    res</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">write</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;data: 连接已建立</span><span style="color:#005CC5;--shiki-dark:#56B6C2">\n\n</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    // 定时发送数据</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">    const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> intervalId</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#6F42C1;--shiki-dark:#61AFEF"> setInterval</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(() </span><span style="color:#D73A49;--shiki-dark:#C678DD">=&gt;</span><span style="color:#24292E;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD">        const</span><span style="color:#005CC5;--shiki-dark:#E5C07B"> data</span><span style="color:#D73A49;--shiki-dark:#56B6C2"> =</span><span style="color:#24292E;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75">            time</span><span style="color:#24292E;--shiki-dark:#ABB2BF">: </span><span style="color:#D73A49;--shiki-dark:#C678DD">new</span><span style="color:#6F42C1;--shiki-dark:#61AFEF"> Date</span><span style="color:#24292E;--shiki-dark:#ABB2BF">().</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">toISOString</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75">            value</span><span style="color:#24292E;--shiki-dark:#ABB2BF">: </span><span style="color:#24292E;--shiki-dark:#E5C07B">Math</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">random</span><span style="color:#24292E;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">        res</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">write</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">`data: </span><span style="color:#032F62;--shiki-dark:#C678DD">${</span><span style="color:#005CC5;--shiki-dark:#E5C07B">JSON</span><span style="color:#032F62;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">stringify</span><span style="color:#032F62;--shiki-dark:#ABB2BF">(</span><span style="color:#24292E;--shiki-dark:#E06C75">data</span><span style="color:#032F62;--shiki-dark:#ABB2BF">)</span><span style="color:#032F62;--shiki-dark:#C678DD">}</span><span style="color:#005CC5;--shiki-dark:#56B6C2">\n\n</span><span style="color:#032F62;--shiki-dark:#98C379">`</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">    }, </span><span style="color:#005CC5;--shiki-dark:#D19A66">1000</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    // 监听连接关闭</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    req</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">on</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;close&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, () </span><span style="color:#D73A49;--shiki-dark:#C678DD">=&gt;</span><span style="color:#24292E;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF">        clearInterval</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#24292E;--shiki-dark:#E06C75">intervalId</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">app</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">listen</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#005CC5;--shiki-dark:#D19A66">3000</span><span style="color:#24292E;--shiki-dark:#ABB2BF">, () </span><span style="color:#D73A49;--shiki-dark:#C678DD">=&gt;</span><span style="color:#24292E;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B">    console</span><span style="color:#24292E;--shiki-dark:#ABB2BF">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF">log</span><span style="color:#24292E;--shiki-dark:#ABB2BF">(</span><span style="color:#032F62;--shiki-dark:#98C379">&#39;SSE 服务器运行在 3000 端口&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF">});</span></span></code></pre> <button class="copy-btn absolute top-2 right-2 z-50 flex items-center gap-1.5 px-2 py-1 rounded bg-white/20 dark:bg-white/5 text-xs text-white hover:bg-primary/10 dark:hover:bg-white/15 transition-colors cursor-pointer opacity-0 group-hover:opacity-100" aria-label="Copy code"> <div class="i-ri:file-copy-line text-sm"></div> <span>Copy</span> </button> </div> </div> 
<h2 id="注意事项">注意事项</h2>
<ol>
<li>格式有特定要求：开头为 <code>data:</code>、结尾为 <code>\n\n</code></li>
<li>每个浏览器的并发 SSE 连接数有限制</li>
<li>某些代理服务器可能不支持长连接</li>
<li>建议实现错误重试机制</li>
<li>大规模使用时注意服务器资源管理</li>
</ol>
<h2 id="sse-与-websocket-的区别">SSE 与 Websocket 的区别</h2>
<h3 id="sse"><strong>SSE</strong></h3>
<p>SSE 是基于传统的 HTTP 协议实现的，采用了长轮询（long-polling）机制。客户端通过向服务器发送一个 HTTP 请求，服务器保持连接打开并周期性地向客户端发送数据。</p>
<p>SSE 通过 <code>EventSource</code> 对象来实现，在客户端可以通过监听 <code>onmessage</code> 事件来接收服务器端发送的数据。</p>
<h3 id="websocket"><strong>WebSocket</strong></h3>
<p>WebSocket 是基于独立的 TCP 连接实现的，使用自定义的协议。客户端和服务器之间可以建立持久的全双工通信的连接，可以双向发送和接收数据。</p>
<p>WebSocket 协议是基于帧的，可以通过发送不同类型的帧进行通信。</p>
<h2 id="总结">总结</h2>
<p>SSE 是一个简单但强大的服务器推送方案：</p>
<ul>
<li>相比 WebSocket 更轻量，实现更简单</li>
<li>单向通信满足大多数推送场景</li>
<li>基于 HTTP 协议，兼容性好</li>
<li>自动重连机制提高可靠性</li>
</ul>
<p>适用场景：</p>
<ul>
<li>实时数据更新</li>
<li>消息通知</li>
<li>日志流式处理</li>
</ul>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html">Server-Sent Events 教程 - 阮一峰的网络日志</a></li>
<li><a href="https://juejin.cn/post/7487831341591511067">高并发场景下，为什么大厂都选择SSE而不是WebSocket？</a></li>
</ul> </div>  <nav class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-12 pt-8 border-t border-border" data-astro-cid-ztig7rse> <a href="/post/2504-cursor-figma-mcp" class="group flex flex-col gap-1 p-4 rounded-lg border-2 border-text shadow-[4px_4px_0_0_var(--color-text)] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-none transition-all" data-astro-cid-ztig7rse> <span class="text-xs text-text-muted flex items-center gap-1 group-hover:text-primary" data-astro-cid-ztig7rse> <div class="i-ri:arrow-left-double-line" data-astro-cid-ztig7rse></div>
上一篇
</span> <span class="font-medium truncate text-text" data-astro-cid-ztig7rse>Cursor 接入 Figma MCP</span> </a> <a href="/post/2507-claude-code-kimi-k2" class="group flex flex-col gap-1 p-4 rounded-lg border-2 border-text shadow-[4px_4px_0_0_var(--color-text)] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-none transition-all text-right" data-astro-cid-ztig7rse> <span class="text-xs text-text-muted flex items-center gap-1 justify-end group-hover:text-primary" data-astro-cid-ztig7rse>
下一篇
<div class="i-ri:arrow-right-double-line" data-astro-cid-ztig7rse></div> </span> <span class="font-medium truncate text-text" data-astro-cid-ztig7rse>Claude Code 中接入 Kimi K2 大模型</span> </a> </nav>  <div class="giscus-container mt-12 pt-8 border-t border-border" data-astro-cid-ztig7rse> <script src="https://giscus.app/client.js" data-repo="AleksChen/AleksChen.github.io" data-repo-id="R_kgDOGjCC6A" data-category="Announcements" data-category-id="DIC_kwDOGjCC6M4CR-S5" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-lang="zh-CN" data-loading="lazy" data-theme="preferred_color_scheme" crossorigin="anonymous" async class="astro-ztig7rse astro-ztig7rse astro-ztig7rse"></script> </div> </article> <aside class="hidden lg:block sticky top-24" data-astro-cid-ztig7rse> <div class="p-4 rounded-lg border-2 border-text bg-card shadow-[4px_4px_0_0_var(--color-text)] max-h-[calc(100vh-8rem)] overflow-y-auto custom-scrollbar" data-astro-cid-ztig7rse> <div class="text-sm font-bold text-text-muted mb-4 uppercase tracking-wider" data-astro-cid-ztig7rse>
目录
</div> <nav class="flex flex-col gap-1 text-sm" data-astro-cid-ztig7rse> <a href="#引言" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="引言" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> 引言 </a><a href="#sse-的本质" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse-的本质" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> SSE 的本质 </a><a href="#sse-的特点" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse-的特点" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> SSE 的特点 </a><a href="#sse-客户端-api" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse-客户端-api" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> SSE 客户端 API </a><a href="#sse-服务端实现" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse-服务端实现" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> SSE 服务端实现 </a><a href="#数据格式" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="数据格式" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> 数据格式 </a><a href="#data-字段" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="data-字段" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> data 字段 </a><a href="#id-字段" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="id-字段" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> id 字段 </a><a href="#event-字段" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="event-字段" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> event 字段 </a><a href="#retry-字段" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="retry-字段" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> retry 字段 </a><a href="#node-服务器实例" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="node-服务器实例" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> Node 服务器实例 </a><a href="#注意事项" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="注意事项" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> 注意事项 </a><a href="#sse-与-websocket-的区别" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse-与-websocket-的区别" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> SSE 与 Websocket 的区别 </a><a href="#sse" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="sse" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> SSE </a><a href="#websocket" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="websocket" style="padding-left: 1.5rem" data-astro-cid-ztig7rse> WebSocket </a><a href="#总结" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="总结" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> 总结 </a><a href="#参考资料" class="toc-link block py-1 px-2 text-text-muted hover:text-white rounded transition-colors truncate" data-id="参考资料" style="padding-left: 0.75rem" data-astro-cid-ztig7rse> 参考资料 </a> </nav> </div> </aside> </div>  </main> <footer class="mt-8 flex flex-col items-center gap-4 py-8"> <div class="flex items-center gap-4"> <a href="https://github.com/AleksChen" target="_blank" class="hover:text-primary transition-transform hover:scale-110 flex items-center gap-1 text-sm font-medium" title="GitHub"> <div class="i-ri:github-fill w-5 h-5"></div> <span class="opacity-80 hover:opacity-100">GitHub</span> </a> <div class="w-px h-4 bg-text opacity-20"></div> <a href="https://juejin.cn/user/254742428393742" target="_blank" class="hover:text-primary transition-transform hover:scale-110 flex items-center gap-1 text-sm font-medium" title="Juejin"> <div class="i-ri:blogger-line w-5 h-5"></div> <span class="opacity-80 hover:opacity-100">Blog</span> </a> <div class="w-px h-4 bg-text opacity-20"></div> <a href="/rss.xml" target="_blank" class="hover:text-primary transition-transform hover:scale-110 flex items-center gap-1 text-sm font-medium" title="RSS"> <div class="i-ri:rss-line w-5 h-5"></div> <span class="opacity-80 hover:opacity-100">RSS</span> </a> </div> <small class="w-full max-w-[720px] min-h-12 flex justify-center items-center opacity-80"> <a href="https://github.com/AleksChen" target="_blank">© 2026 AleksChen</a> </small> </footer> <script type="module">let l=window.scrollY;const t=document.getElementById("main-header"),s=()=>{const e=window.scrollY;t&&(e<l||e<=100?t.classList.remove("-translate-y-full"):e>100&&e>l&&t.classList.add("-translate-y-full"),l=e)};window.addEventListener("scroll",s,{passive:!0});</script> <script type="module">const l=()=>{const e=document.documentElement;e.classList.toggle("dark");const t=e.classList.contains("dark");localStorage.setItem("theme",t?"dark":"light")};document.getElementById("theme-toggle")?.addEventListener("click",l);</script> <script type="module">window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};plausible.init();</script> </body> </html> <script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

  // 更精确地检测 <html> 是否带有 dark class，优先用 class，否则 fallback 到 media query
  const html = document.documentElement;
  const isDark =
    html.classList.contains("dark") ||
    (!html.classList.contains("light") &&
      window.matchMedia("(prefers-color-scheme: dark)").matches);

  mermaid.initialize({
    startOnLoad: true,
    theme: isDark ? "dark" : "default",
    themeVariables: isDark ? { darkMode: true } : { darkMode: false },
  });
</script> <script type="module">const i=new IntersectionObserver(e=>{e.forEach(o=>{if(o.isIntersecting){const r=o.target.id;document.querySelectorAll(".toc-link").forEach(t=>{t.classList.toggle("text-white",t.getAttribute("data-id")===r),t.classList.toggle("bg-primary/10",t.getAttribute("data-id")===r),t.classList.toggle("font-medium",t.getAttribute("data-id")===r)})}})},{rootMargin:"-100px 0px -60% 0px"});document.querySelectorAll("h1[id], h2[id], h3[id]").forEach(e=>{i.observe(e)});</script> 