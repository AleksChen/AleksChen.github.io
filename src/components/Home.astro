---
import Layout from "../layouts/Layout.astro";
import type { ShortPostData } from "@/lib/posts";
import Rocket from "@/components/Rocket.astro";
import Mountain from "@/components/Mountain.astro";
import TypeWriter from "@/components/TypeWriter.astro";

import { PostCard } from "./PostCard";

interface Props {
  posts: ShortPostData[];
  page: number;
  more: boolean;
}

const { posts, page, more } = Astro.props;
---

<Layout
  title="AleksChen's blog"
  description="AleksChen's blog - 记录技术点滴"
  seo={{
    type: "website",
  }}
>
  <div slot="background" class="hidden md:block">
    <!-- Three.js 火箭背景 -->
    <Rocket />
    <!-- 山峰视差背景 -->
    <Mountain />
  </div>

  <div class="flex flex-col gap-8 relative z-10 items-center">
    <section id="hero-section" class="text-center py-8 md:py-12">
      <h1
        class="text-4xl md:text-7xl font-bold text-text mb-6 drop-shadow-[4px_4px_0_var(--color-shadow)]"
      >
        <TypeWriter
          text="AleksChen's Blog"
          speed={150}
          wait={3000}
          loop={false}
          cursor={false}
        />
      </h1>
      <p class="text-text-muted text-lg max-w-2xl mx-auto">
        <TypeWriter
          text="活在当下 记录时间"
          speed={250}
          wait={3000}
          loop={false}
          cursor={false}
        />
      </p>
    </section>

    <div class="flex flex-col gap-6 max-w-[800px]">
      {
        posts.map((item, index) => (
          <PostCard
            item={item}
            index={index}
            formattedDate={new Date(item.createTime).toLocaleDateString()}
          />
        ))
      }
    </div>

    {
      more && (
        <div class="w-full flex justify-center mt-8">
          <a href={`/${page + 1}`} class="btn btn-primary px-8 py-3">
            加载更多
          </a>
        </div>
      )
    }
  </div>
</Layout>

<script>
  // Hero section 淡出效果
  const heroSection = document.getElementById("hero-section");
  if (heroSection) {
    const fadeOutHeight = 249; // 滚动多少像素后完全消失

    const handleScroll = () => {
      const scrollY = window.scrollY;
      const opacity = Math.max(0, 1 - scrollY / fadeOutHeight);
      heroSection.style.opacity = opacity.toString();
    };

    handleScroll(); // 初始化
    window.addEventListener("scroll", handleScroll, { passive: true });
  }
</script>
